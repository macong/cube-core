/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 30 19:00
*/
KISSY.add("dd/constrain",function(d,i,j){function h(){h.superclass.constructor.apply(this,arguments)}function g(e){var a,b,e=e.drag.get("dragNode"),l=this.get("constrain");if(l){if(!0===l){var c=k(o);this.__constrainRegion={left:a=c.scrollLeft(),top:b=c.scrollTop(),right:a+c.width(),bottom:b+c.height()}}if(l.nodeType||d.isString(l))l=k(l);l.getDOMNode?(a=l.offset(),this.__constrainRegion={left:a.left,top:a.top,right:a.left+l.outerWidth(),bottom:a.top+l.outerHeight()}):d.isPlainObject(l)&&(this.__constrainRegion=
l);this.__constrainRegion&&(this.__constrainRegion.right-=e.outerWidth(),this.__constrainRegion.bottom-=e.outerHeight())}}function f(e){var e=e.info,a=e.left,b=e.top,c=this.__constrainRegion;c&&(e.left=Math.min(Math.max(c.left,a),c.right),e.top=Math.min(Math.max(c.top,b),c.bottom))}function c(){this.__constrainRegion=null}var k=j.all,a=d.stamp,p=d.guid("__dd_constrain"),o=d.Env.host;d.extend(h,i,{__constrainRegion:null,attachDrag:function(e){var d=a(e,1,p);if(d&&this.__constrain_destructors[d])return this;
e.on("dragstart",g,this).on("dragend",c,this).on("dragalign",f,this);return this},detachDrag:function(e){var d=a(e,1,p),b=this.__constrain_destructors;d&&b[d]&&(e.detach("dragstart",g,this).detach("dragend",c,this).detach("dragalign",f,this),delete b[d]);return this},destroy:function(){var a=this,c=d.merge(a.__constrain_destructors);d.each(c,function(b){a.detachDrag(b)})}},{ATTRS:{constrain:{value:!0}}});return h},{requires:["base","node"]});
KISSY.add("dd",function(d,i,j,h,g,f,c,k,a){return{Draggable:j,Droppable:h,DDM:i,Constrain:f,Proxy:g,DraggableDelegate:c,DroppableDelegate:k,Scroll:a}},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(d,i,j,h,g,f){function c(){c.superclass.constructor.apply(this,arguments)}function k(a,e,c){var p=c.get("mode"),k=a.get("validDrops"),f=0,g=0,o=n(c.get("node")),j=l(o);d.each(k,function(a){var m;if(m=a.getNodeFromTarget(e,c.get("dragNode")[0],c.get("node")[0]))if("point"==p)b(n(m),c.mousePos)&&(m=l(n(m)),f?m<g&&(f=a,g=m):(f=a,g=m));else if("intersect"==p)m=l(x(o,n(m))),m>g&&(g=m,f=a);else if("strict"==p&&(m=l(x(o,n(m))),m==j))return f=a,!1});if((k=a.get("activeDrop"))&&
k!=f)k._handleOut(e),c._handleOut(e);a.__set("activeDrop",f);f&&(k!=f?f._handleEnter(e):f._handleOver(e))}function a(b){b._shim=(new g("<div style='background-color:red;position:"+(v?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+q.get("dragCursor")+";z-index:"+w+";'></div>")).prependTo(s.body||s.documentElement).css("opacity",0);a=p;if(v)h.on(r,"resize scroll",t,b);p(b)}function p(b){var a=b.get("activeDrag").get("activeHandler"),e="auto";a&&(e=a.css("cursor"));"auto"==e&&(e=
b.get("dragCursor"));b._shim.css({cursor:e,display:"block"});v&&t.call(b)}function o(b){var a=b.get("drops");b.__set("validDrops",[]);d.each(a,function(b){b._active()})}function e(b){var a=b.get("drops");b.__set("validDrops",[]);d.each(a,function(b){b._deActive()})}function n(b){var a=b.offset();return{left:a.left,right:a.left+(b.__dd_cached_width||b.outerWidth()),top:a.top,bottom:a.top+(b.__dd_cached_height||b.outerHeight())}}function b(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&
b.bottom>=a.top}function l(b){return b.top>=b.bottom||b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function x(b,a){var e=Math.max(b.top,a.top),c=Math.min(b.right,a.right),l=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:c,top:e,bottom:l}}function y(b){b&&(b.__dd_cached_width=b.outerWidth(),b.__dd_cached_height=b.outerHeight())}var r=d.Env.host,s=r.document,v=6===i.ie,u=d.throttle(function(b){var a;if(a=this.__activeToDrag)b.preventDefault(),a._move(b);else if(a=this.get("activeDrag"))b.preventDefault(),
a._move(b),k(this,b,a)},30),w=999999;c.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var t=d.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:j.docWidth(),height:j.docHeight()})},30);d.extend(c,f,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=d.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,1)},
_regToDrag:function(b){this.__activeToDrag=b;h.on(s,"mouseup",this._end,this);h.on(s,"mousemove",u,this);6===i.ie&&s.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&a(this);y(b.get("node"));o(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");h.remove(s,"mousemove",u,this);h.remove(s,"mouseup",this._end,this);6===i.ie&&
s.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(),e(this),a&&a._end(),this.__set("activeDrag",null),this.__set("activeDrop",null))}});var q=new c;q.inRegion=b;q.region=n;q.area=l;q.cacheWH=y;q.PREFIX_CLS="ks-dd-";return q},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(d,i,j,h,g){function f(){f.superclass.constructor.apply(this,arguments)}function c(a){var c,d;if(this._checkMouseDown(a)){c=this.get("handlers");var e=new g(a.target);(c=c.length?this._getHandler(e):e)&&(d=this._getNode(c));d&&(this.__set("activeHandler",c),this.__set("node",d),this.__set("dragNode",d),this._prepare(a))}}var k=i.PREFIX_CLS;d.extend(f,j,{_uiSetDisabledChange:function(a){this.get("container")[a?"addClass":"removeClass"](k+"-disabled")},_init:function(){this.get("container").on("mousedown",
c,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var c=void 0,f=this.get("container"),e=this.get("handlers");a&&a[0]!==f[0];){d.each(e,function(e){if(h.test(a[0],e))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",c,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return g.one(a)}},selector:{},
handlers:{value:[],getter:0}}});return f},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(d,i,j,h,g){function f(){var b=this;f.superclass.constructor.apply(b,arguments);b.addTarget(g);d.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.__set("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var a;(a=b.get("disabled"))&&b._uiSetDisabledChange(a);b._init()}function c(){return!1}function k(b){var a=b.target;this._checkMouseDown(b)&&
this._check(a)&&this._prepare(b)}var a=d.each,p=i.ie,o=g.PREFIX_CLS,e=d.Env.host.document;f.POINT="point";f.INTERSECT="intersect";f.STRICT="strict";f.ATTRS={node:{setter:function(b){if(!(b instanceof j))return j.one(b)}},clickPixelThresh:{valueFn:function(){return g.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return g.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var c=this;b.length||(b[0]=c.get("node"));a(b,function(a,e){d.isFunction(a)&&(a=a.call(c));
if(d.isString(a)||a.nodeType)a=j.one(a);b[e]=a});c.__set("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](o+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};var n;d.extend(f,h,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](o+"-disabled")},
_init:function(){this.get("node").on("mousedown",k,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_check:function(b){var c=this,e=c.get("handlers"),d=0;a(e,function(a){if(a.contains(b)||a[0]==b)return d=1,c.__set("activeHandler",a),!1});return d},_checkMouseDown:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;p&&(n=e.body.onselectstart,e.body.onselectstart=c);a.get("halt")?b.halt():b.preventDefault();
var d=a.get("node"),f=b.pageX,b=b.pageY,d=d.offset();a.startMousePos=a.mousePos={left:f,top:b};a.startNodePos=d;a._diff={left:f-d.left,top:b-d.top};g._regToDrag(a);if(f=a.get("bufferTime"))a._bufferTimer=setTimeout(function(){a._start()},f)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a,c=this._diff;a=this.startMousePos;var e=b.pageX,b=b.pageY,d=e-c.left,c=b-c.top;this.get("dragging")?(this.mousePos={left:e,top:b},a=
{left:d,top:c,pageX:e,pageY:b,drag:this},this.fire("dragalign",{info:a}),e=1,!1===this.fire("drag",a)&&(e=0),e&&this.get("move")&&this.get("node").offset(a)):(c=this.get("clickPixelThresh"),(Math.abs(e-a.left)>=c||Math.abs(b-a.top)>=c)&&this._start())},stopDrag:function(){this.get("dragging")&&g._end()},_end:function(){var b;this._clearBufferTimer();p&&(e.body.onselectstart=n);this.get("dragging")&&(this.get("node").removeClass(o+"drag-over"),(b=g.get("activeDrop"))?this.fire("dragdrophit",{drag:this,
drop:b}):this.fire("dragdropmiss",{drag:this}),this.__set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(o+"drag-over");this.fire("dragexit",{drag:this,drop:g.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(o+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);g._start();this.fire("dragstart",{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",
k,this).detach("dragstart",this._fixDragStart);this.detach()}});return f},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(d,i,j,h,g){function f(){var c=this.get("container"),a=[],d=this.get("selector");c.all(d).each(function(c){i.cacheWH(c);a.push(c)});this.__allNodes=a}function c(){c.superclass.constructor.apply(this,arguments);i.on("dragstart",f,this)}d.extend(c,j,{destroy:function(){c.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(c,a,f){var g={left:c.pageX,top:c.pageY},c=this.__allNodes,e=0,n=Number.MAX_VALUE;c&&d.each(c,function(b){var c=b[0];c===
f||c===a||(c=i.region(b),i.inRegion(c,g)&&(c=i.area(c),c<n&&(n=c,e=b)))});e&&(this.__set("lastNode",this.get("node")),this.__set("node",e));return e},_handleOut:function(){c.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(d){var a=this.get("node"),f=c.superclass._handleOut,g=c.superclass._handleOver,e=c.superclass._handleEnter,n=this.get("lastNode");n[0]!==a[0]?(this.__set("node",n),f.apply(this,arguments),this.__set("node",a),e.call(this,
d)):g.call(this,d)},_end:function(){c.superclass._end.apply(this,arguments);this.__set("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(c){return g.one(c)}}}});return c},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(d,i,j,h){function g(){var c=this;g.superclass.constructor.apply(c,arguments);c.addTarget(h);d.each(["dropexit","dropenter","dropover","drophit"],function(d){c.publish(d,{bubbles:1})});c._init()}var f=h.PREFIX_CLS;g.ATTRS={node:{setter:function(c){if(c)return i.one(c)}},groups:{value:!0}};d.extend(g,j,{getNodeFromTarget:function(c,d,a){var c=this.get("node"),f=c[0];return f==d||f==a?null:c},_init:function(){h._regDrop(this)},_active:function(){var c=h.get("activeDrag"),
d=this.get("node"),a=this.get("groups"),c=c.get("groups");a:if(!0===a)a=1;else{for(var g in a)if(c[g]){a=1;break a}a=0}a?(h._addValidDrop(this),d&&(d.addClass(f+"drop-active-valid"),h.cacheWH(d))):d&&d.addClass(f+"drop-active-invalid")},_deActive:function(){var c=this.get("node");c&&c.removeClass(f+"drop-active-valid").removeClass(f+"drop-active-invalid")},__getCustomEvt:function(c){return d.mix({drag:h.get("activeDrag"),drop:this},c)},_handleOut:function(){var c=this.__getCustomEvt();this.get("node").removeClass(f+
"drop-over");this.fire("dropexit",c)},_handleEnter:function(c){c=this.__getCustomEvt(c);c.drag._handleEnter(c);this.get("node").addClass(f+"drop-over");this.fire("dropenter",c)},_handleOver:function(c){c=this.__getCustomEvt(c);c.drag._handleOver(c);this.fire("dropover",c)},_end:function(){var c=this.__getCustomEvt();this.get("node").removeClass(f+"drop-over");this.fire("drophit",c)},destroy:function(){h._unRegDrop(this)}});return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(d,i,j,h){function g(){g.superclass.constructor.apply(this,arguments);this[f]={}}var f="__proxy_destructors",c=d.stamp,k=d.guid("__dd_proxy");g.ATTRS={node:{value:function(a){return new i(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0},proxyNode:{}};d.extend(g,j,{attachDrag:function(a){function g(){var b=e.get("node"),c=a.get("node");e.get("proxyNode")?b=e.get("proxyNode"):d.isFunction(b)&&(b=b(a),b.addClass("ks-dd-proxy"),b.css("position","absolute"),
e.set("proxyNode",b));b.show();c.parent().append(b);h.cacheWH(b);b.offset(c.offset());a.__set("dragNode",c);a.__set("node",b)}function j(){var b=e.get("proxyNode");e.get("moveOnEnd")&&a.get("dragNode").offset(b.offset());e.get("destroyOnEnd")?(b.remove(),e.set("proxyNode",0)):b.hide();a.__set("node",a.get("dragNode"))}var e=this,n=c(a,1,k);if(n&&e[f][n])return e;a.on("dragstart",g);a.on("dragend",j);n=c(a,0,k);e[f][n]={drag:a,fn:function(){a.detach("dragstart",g);a.detach("dragend",j)}};return e},
detachDrag:function(a){var a=c(a,1,k),d=this[f];a&&d[a]&&(d[a].fn(),delete d[a]);return this},destroy:function(){var a=this.get("node"),c=this[f];a&&!d.isFunction(a)&&a.remove();for(var g in c)this.detachDrag(c[g].drag)}});j=g.prototype;j.attach=j.attachDrag;j.unAttach=j.detachDrag;return g},{requires:["node","base","./ddm"]});
KISSY.add("dd/scroll",function(d,i,j,h,g){function f(){f.superclass.constructor.apply(this,arguments);this[p]={}}var c=d.Env.host,k=d.stamp,a=100,p="__dd_scrolls";f.ATTRS={node:{valueFn:function(){return h.one(c)},setter:function(a){return h.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var o=d.isWindow;d.extend(f,j,{getRegion:function(a){return o(a[0])?{width:g.viewportWidth(),height:g.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return o(a[0])?{left:g.scrollLeft(),
top:g.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,c){a.scrollLeft(c.left);a.scrollTop(c.top)},detachDrag:function(a){var c,b=this[p];if((c=k(a,1,"__dd-scroll-id-"))&&b[c])return b[c].fn(),delete b[c],this},destroy:function(){var a=this;d.each(a[p],function(c){a.detachDrag(c.drag)})},attachDrag:function(c){function f(){if(o(r[0]))return 0;var a=c.mousePos,b=i.region(r);return!i.inRegion(b,a)?(clearTimeout(m),m=0,1):0}function b(a){!a.fake&&
!f()&&(t=a,q=d.clone(c.mousePos),a=h.getOffset(r),q.left-=a.left,q.top-=a.top,m||j())}function g(){clearTimeout(m);m=null}function j(){if(!f()){var b=h.getRegion(r),g=b.width,b=b.height,i=h.getScroll(r),k=d.clone(i),l=!1;q.top-b>=-w[1]&&(i.top+=u[1],l=!0);q.top<=w[1]&&(i.top-=u[1],l=!0);q.left-g>=-w[0]&&(i.left+=u[0],l=!0);q.left<=w[0]&&(i.left-=u[0],l=!0);l?(h.setScroll(r,i),m=setTimeout(j,a),t.fake=!0,o(r[0])&&(i=h.getScroll(r),t.left+=i.left-k.left,t.top+=i.top-k.top),c.get("move")&&c.get("node").offset(t),
c.fire("drag",t)):m=null}}var h=this,r=h.get("node"),s=k(c,0,"__dd-scroll-id-"),v=h[p];if(!v[s]){var u=h.get("rate"),w=h.get("diff"),t,q,m=null;c.on("drag",b);c.on("dragstart",function(){i.cacheWH(r)});c.on("dragend",g);v[s]={drag:c,fn:function(){c.detach("drag",b);c.detach("dragend",g)}};return this}}});j=f.prototype;j.attach=j.attachDrag;j.unAttach=j.detachDrag;return f},{requires:["./ddm","base","node","dom"]});
