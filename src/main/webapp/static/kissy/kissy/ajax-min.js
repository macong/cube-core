/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 30 19:00
*/
KISSY.add("ajax/FormSerializer",function(c,i){var h=/^(?:select|textarea)/i,f=/\r?\n/g,g,e=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return g={serialize:function(d){return c.param(g.getFormData(d),void 0,void 0,!1)},getFormData:function(d){var b=[],a={};c.each(i.query(d),function(a){a=a.elements?c.makeArray(a.elements):[a];b.push.apply(b,a)});b=c.filter(b,function(a){return a.name&&!a.disabled&&(a.checked||h.test(a.nodeName)||e.test(a.type))});
c.each(b,function(b){var o=i.val(b),o=c.map(c.makeArray(o),function(a){return a.replace(f,"\r\n")}),b=a[b.name]=a[b.name]||[];b.push.apply(b,o)});return a}}},{requires:["dom"]});
KISSY.add("ajax/IframeTransport",function(c,i,h,f){function g(a){var j=c.guid("ajax-iframe"),o=i.getEmptyIframeSrc(),a=a.iframe=i.create("<iframe "+(o?' src="'+o+'" ':"")+" id='"+j+"' name='"+j+"' style='position:absolute;left:-9999px;top:-9999px;'/>");i.prepend(a,b.body||b.documentElement);return a}function e(a,j,o){var d=[],g,e,h,f,s=a.keys();c.each(s,function(n){var r=a.get(n);g=c.isArray(r);e=c.makeArray(r);for(h=0;h<e.length;h++)f=b.createElement("input"),f.type="hidden",f.name=n+(g&&o?"[]":
""),f.value=e[h],i.append(f,j),d.push(f)});return d}function d(a){this.xhrObject=a}var b=c.Env.host.document;f.setupConfig({converters:{iframe:f.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});c.augment(d,{send:function(){var a=this,b=a.xhrObject,d=b.config,c,p,f=d.query,l=i.get(d.form);a.attrs={target:i.attr(l,"target")||"",action:i.attr(l,"action")||"",method:i.attr(l,"method")};a.form=l;p=g(b);i.attr(l,{target:p.id,action:d.uri.toString(d.serializeArray),
method:"post"});f.count()&&(c=e(f,l,d.serializeArray));a.fields=c;setTimeout(function(){h.on(p,"load error",a._callback,a);l.submit()},10)},_callback:function(a){var b=this.xhrObject,a=a.type,d=b.iframe;if(d)if(i.attr(this.form,this.attrs),i.remove(this.fields),h.detach(d),setTimeout(function(){i.remove(d)},30),b.iframe=null,"load"==a){if((a=d.contentWindow.document)&&a.body)b.responseText=c.trim(i.text(a.body)),c.startsWith(b.responseText,"<?xml")&&(b.responseText=void 0);b.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;b._xhrReady(200,"success")}else"error"==a&&b._xhrReady(500,"error")},abort:function(){this._callback({})}});f.setupTransport("iframe",d);return f},{requires:["dom","event","./base"]});
KISSY.add("ajax/ScriptTransport",function(c,i,h,f){function g(b){if(!b.config.crossDomain)return new (i.getTransport("*"))(b);this.xhrObj=b;return 0}var e=c.Env.host,d=e.document;i.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(b){c.globalEval(b);return b}}}});c.augment(g,{send:function(){var b=this,a,j=b.xhrObj.config,c=d.head||d.getElementsByTagName("head")[0]||
d.documentElement;b.head=c;a=d.createElement("script");b.script=a;a.async="async";j.scriptCharset&&(a.charset=j.scriptCharset);a.src=j.uri.toString(j.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(a){a=a||e.event;b._callback((a.type||"error").toLowerCase())};c.insertBefore(a,c.firstChild)},_callback:function(b,a){var d=this.script,c=this.xhrObj,k=this.head;if(d&&(a||!d.readyState||/loaded|complete/.test(d.readyState)||"error"==b))d.onerror=d.onload=d.onreadystatechange=null,k&&d.parentNode&&
k.removeChild(d),this.head=this.script=f,!a&&"error"!=b?c._xhrReady(200,"success"):"error"==b&&c._xhrReady(500,"scripterror")},abort:function(){this._callback(0,1)}});i.setupTransport("script",g);return i},{requires:["./base","./XhrTransport"]});
KISSY.add("ajax/SubDomainTransport",function(c,i,h,f){function g(a){var b=a.config;this.xhrObj=a;b.crossDomain=!1}function e(){var a=this.xhrObj.config.uri.getHostname(),a=b[a];a.ready=1;h.detach(a.iframe,"load",e,this);this.send()}var d=c.Env.host.document,b={};c.augment(g,i.proto,{send:function(){var a=this.xhrObj.config,j=a.uri,o=j.getHostname(),k;k=b[o];var g="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(g=a.xdr.subDomain.proxy);k&&k.ready?(this.nativeXhr=i.nativeXhr(0,
k.iframe.contentWindow))&&this.sendInternal():(k?a=k.iframe:(k=b[o]={},a=k.iframe=d.createElement("iframe"),f.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),f.prepend(a,d.body||d.documentElement),k=new c.Uri,k.setScheme(j.getScheme()),k.setHostname(o),k.setPath(g),a.src=k.toString()),h.on(a,"load",e,this))}});return g},{requires:["./XhrTransportBase","event","dom"]});
KISSY.add("ajax/XdrFlashTransport",function(c,i,h){function f(b,c,g){j||(j=!0,b='<object id="'+d+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+c+"&uid="+g+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',c=a.createElement("div"),h.prepend(c,a.body||a.documentElement),c.innerHTML=b)}function g(a){this.xhrObj=a}var e={},d="io_swf",b,a=c.Env.host.document,
j=!1;c.augment(g,{send:function(){var a=this,d=a.xhrObj.config;f((d.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);b?(a._uid=c.guid(),e[a._uid]=a,b.send(d.uri.toString(d.serializeArray),{id:a._uid,uid:a._uid,method:d.type,data:d.hasContent&&d.query.toString(d.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(a,b){var d,c=b.id,j=this.xhrObj;j.responseText=decodeURI(b.c.responseText);switch(a){case "success":d={status:200,statusText:"success"};
delete e[c];break;case "abort":delete e[c];break;case "timeout":case "transport error":case "failure":delete e[c],d={status:500,statusText:a}}d&&j._xhrReady(d.status,d.statusText)}});i.applyTo=function(a,b,d){var a=b.split(".").slice(1),j=i;c.each(a,function(a){j=j[a]});j.apply(null,d)};i.xdrReady=function(){b=a.getElementById(d)};i.xdrResponse=function(a,b){var d=e[b.uid];d&&d._xdrResponse(a,b)};return g},{requires:["./base","dom"]});
KISSY.add("ajax/XhrObject",function(c,i){function h(d){var b=d.responseText,a=d.responseXML,j=d.config,g=j.converters,e=d.converters||{},f,h,l=j.contents,m=j.dataType;if(b||a){for(j=d.mimeType||d.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(f in l)if(l.hasOwnProperty(f)&&l[f].test(j)){m[0]!=f&&m.unshift(f);break}m[0]=m[0]||"text";if("text"==m[0]&&b!==i)h=b;else if("xml"==m[0]&&a!==i)h=a;else{var s={text:b,xml:a};c.each(["text","xml"],function(d){var c=m[0];if((e[d]&&e[d][c]||
g[d]&&g[d][c])&&s[d])return m.unshift(d),h="text"==d?b:a,!1})}}l=m[0];for(j=1;j<m.length;j++){f=m[j];var n=e[l]&&e[l][f]||g[l]&&g[l][f];if(!n)throw"no covert for "+l+" => "+f;h=n(h);l=f}d.responseData=h}function f(d){g.call(this);c.mix(this,{responseData:null,config:d||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)})}var g=c.Promise,e=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;
c.extend(f,g,{setRequestHeader:function(d,b){this.requestHeaders[d]=b;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(d){var b,a;if(2===this.state){if(!(a=this.responseHeaders))for(a=this.responseHeaders={};b=e.exec(this.responseHeadersString);)a[b[1]]=b[2];b=a[d]}return b===i?null:b},overrideMimeType:function(d){this.state||(this.mimeType=d);return this},abort:function(d){d=d||"abort";this.transport&&this.transport.abort(d);
this._xhrReady(0,d);return this},getNativeXhr:function(){var d;if(d=this.transport)return d.nativeXhr},_xhrReady:function(d,b){if(2!=this.state){this.state=2;this.readyState=4;var a;if(200<=d&&300>d||304==d)if(304==d)b="notmodified",a=!0;else try{h(this),b="success",a=!0}catch(c){b="parsererror : "+c}else 0>d&&(d=0);this.status=d;this.statusText=b;this._defer[a?"resolve":"reject"]([this.responseData,this.statusText,this])}}});return f});
KISSY.add("ajax/XhrTransport",function(c,i,h,f,g,e){var d=c.Env.host.XDomainRequest,b=h.nativeXhr();if(b){var a=function(a){var a=a.split("."),b=a.length,d=3<b?3:2;return b<d?a.join("."):a.reverse().slice(0,d).reverse().join(".")},j=function(c){var j=c.config,i=j.crossDomain,q=j.xdr||{};if(i){if(a(location.hostname)==a(j.uri.getHostname()))return new f(c);if(!("withCredentials"in b)&&("flash"===""+q.use||!d))return new g(c)}this.xhrObj=c;this.nativeXhr=h.nativeXhr(i);return e};c.augment(j,h.proto,
{send:function(){this.sendInternal()}});i.setupTransport("*",j)}return i},{requires:["./base","./XhrTransportBase","./SubDomainTransport","./XdrFlashTransport"]});
KISSY.add("ajax/XhrTransportBase",function(c,i){function h(d,b){try{return new (b||f).XMLHttpRequest}catch(a){}}var f=c.Env.host,g=f.XDomainRequest,e={proto:{}};e.nativeXhr=f.ActiveXObject?function(d,b){var a;if(d&&g)a=new g;else if(!(a=!i.isLocal&&h(d,b)))a:{try{a=new (b||f).ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}a=void 0}return a}:h;c.mix(e.proto,{sendInternal:function(){var d=this,b=d.xhrObj,a=b.config,c=d.nativeXhr,e=a.type,f=a.async,i,h=a.crossDomain,l=b.mimeType,b=b.requestHeaders,
m=a.serializeArray,s=a.uri.toString(m),n;(i=a.username)?c.open(e,s,f,i,a.password):c.open(e,s,f);if(e=a.xhrFields)for(n in e)e.hasOwnProperty(n)&&(c[n]=e[n]);l&&c.overrideMimeType&&c.overrideMimeType(l);!h&&!b["X-Requested-With"]&&(b["X-Requested-With"]="XMLHttpRequest");try{if(!h)for(n in b)b.hasOwnProperty(n)&&c.setRequestHeader(n,b[n])}catch(r){}c.send(a.hasContent&&a.query.toString(m)||null);!f||4==c.readyState?d._callback():g&&c instanceof g?(c.onload=function(){c.readyState=4;c.status=200;d._callback()},
c.onerror=function(){c.readyState=4;c.status=500;d._callback()}):c.onreadystatechange=function(){d._callback()}},abort:function(){this._callback(0,1)},_callback:function(d,b){try{var a=this.nativeXhr,e=this.xhrObj,f=e.config;if(b||4==a.readyState)if(g&&a instanceof g?(a.onerror=c.noop,a.onload=c.noop):a.onreadystatechange=c.noop,b)4!==a.readyState&&a.abort();else{var h=a.status;g&&a instanceof g||(e.responseHeadersString=a.getAllResponseHeaders());var p=a.responseXML;p&&p.documentElement&&(e.responseXML=
p);e.responseText=a.responseText;try{var q=a.statusText}catch(l){q=""}!h&&i.isLocal&&!f.crossDomain?h=e.responseText?200:404:1223===h&&(h=204);e._xhrReady(h,q)}}catch(m){a.onreadystatechange=c.noop,b||e._xhrReady(-1,m)}}});return e},{requires:["./base"]});
KISSY.add("ajax",function(c,i,h,f){function g(d,b,a,g,f){c.isFunction(b)&&(g=a,a=b,b=e);return h({type:f||"get",url:d,data:b,success:a,dataType:g})}var e=void 0;c.mix(h,{XhrObject:f,serialize:i.serialize,get:g,post:function(d,b,a,f){c.isFunction(b)&&(f=a,a=b,b=e);return g(d,b,a,f,"post")},jsonp:function(d,b,a){c.isFunction(b)&&(a=b,b=e);return g(d,b,a,"jsonp")},getScript:c.getScript,getJSON:function(d,b,a){c.isFunction(b)&&(a=b,b=e);return g(d,b,a,"json")},upload:function(d,b,a,g,f){c.isFunction(a)&&
(f=g,g=a,a=e);return h({url:d,type:"post",dataType:f,form:b,data:a,success:g})}});c.mix(c,{Ajax:h,IO:h,ajax:h,io:h,jsonp:h.jsonp});return h},{requires:"ajax/FormSerializer,ajax/base,ajax/XhrObject,ajax/XhrTransport,ajax/ScriptTransport,ajax/jsonp,ajax/form,ajax/IframeTransport".split(",")});
KISSY.add("ajax/base",function(c,i,h,f,g){function e(b){var d=b.context;delete b.context;b=c.mix(c.clone(r),b,{deep:!0});b.context=d||b;var g,e=b.type,f=b.dataType,h;h=b.query=new c.Uri.Query;d=b.uri=m.resolve(b.url);"crossDomain"in b||(b.crossDomain=!b.uri.hasSameDomainAs(m));if(b.processData&&(g=b.data))c.isObject(g)?h.add(g):h.reset(g);e=b.type=e.toUpperCase();b.hasContent=!o.test(e);f=b.dataType=c.trim(f||"*").split(a);!("cache"in b)&&c.inArray(f[0],["script","jsonp"])&&(b.cache=!1);b.hasContent||
(h.count()&&d.query.add(h),!1===b.cache&&d.query.set("_ksTS",c.now()+"_"+c.guid()));return b}function d(a,d){b.fire(a,{ajaxConfig:d.config,xhr:d})}function b(a){function b(g){return function(b){if(j=c.timeoutTimer)clearTimeout(j),c.timeoutTimer=0;var e=a[g];e&&e.apply(m,b);d(g,c)}}if(!a.url)return g;var a=e(a),c=new f(a),h;d("start",c);h=new (n[a.dataType[0]]||n["*"])(c);c.transport=h;a.contentType&&c.setRequestHeader("Content-Type",a.contentType);var i=a.dataType[0],j,k,l=a.timeout,m=a.context,o=
a.headers,p=a.accepts;c.setRequestHeader("Accept",i&&p[i]?p[i]+("*"===i?"":", */*; q=0.01"):p["*"]);for(k in o)o.hasOwnProperty(k)&&c.setRequestHeader(k,o[k]);if(a.beforeSend&&!1===a.beforeSend.call(m,c,a))return g;c.then(b("success"),b("error"));c.fin(b("complete"));c.readyState=1;d("send",c);a.async&&0<l&&(c.timeoutTimer=setTimeout(function(){c.abort("timeout")},1E3*l));try{c.state=1,h.send()}catch(q){2>c.state&&c._xhrReady(-1,q)}return c}var a=/\s+/,j=function(a){return a},o=/^(?:GET|HEAD)$/,k,
p=c.Uri,q=c.Env.host,l=q.document,q=q.location,m;try{k=q.href}catch(s){k=l.createElement("a"),k.href="",k=k.href}m=new p(k);k=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/.test(m.getScheme());var n={},r={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:i.parse,html:j,text:j,
xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};r.converters.html=r.converters.text;c.mix(b,h.Target);c.mix(b,{isLocal:k,setupConfig:function(a){c.mix(r,a,{deep:!0})},setupTransport:function(a,b){n[a]=b},getTransport:function(a){return n[a]},getConfig:function(){return r}});return b},{requires:["json","event","./XhrObject"]});
KISSY.add("ajax/form",function(c,i,h,f){i.on("start",function(c){var e,d,c=c.xhr.config;if(e=c.form)e=h.get(e),d=e.encoding||e.enctype,"multipart/form-data"!=d.toLowerCase()?(e=f.getFormData(e),c.hasContent?c.query.add(e):c.uri.query.add(e)):(e=c.dataType,c=e[0],"*"==c&&(c="text"),e.length=2,e[0]="iframe",e[1]=c)});return i},{requires:["./base","dom","./FormSerializer"]});
KISSY.add("ajax/jsonp",function(c,i){var h=c.Env.host;i.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});i.on("start",function(f){var g=f.xhr,e=g.config,f=e.dataType;if("jsonp"==f[0]){var d,b=e.jsonpCallback,a=c.isFunction(b)?b():b,i=h[a];e.uri.query.set(e.jsonp,a);h[a]=function(a){1<arguments.length&&(a=c.makeArray(arguments));d=[a]};g.fin(function(){h[a]=i;if(void 0===i)try{delete h[a]}catch(b){}else d&&i(d[0])});g=g.converters=g.converters||{};g.script=g.script||
{};g.script.json=function(){return d[0]};f.length=2;f[0]="script";f[1]="json"}});return i},{requires:["./base"]});
